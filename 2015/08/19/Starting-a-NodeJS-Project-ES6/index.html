<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Starting a NodeJS Project - ES6 | The Wrong Language</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="In the previous post, I set up a new NPM project to work with, and added in Grunt as a task runner so that we can do complex tasks if we want to. Next is setting it up to build ES6 code into ES5 via B">
<meta property="og:type" content="article">
<meta property="og:title" content="Starting a NodeJS Project - ES6">
<meta property="og:url" content="https://sazzer.github.io/blog/2015/08/19/Starting-a-NodeJS-Project-ES6/index.html">
<meta property="og:site_name" content="The Wrong Language">
<meta property="og:description" content="In the previous post, I set up a new NPM project to work with, and added in Grunt as a task runner so that we can do complex tasks if we want to. Next is setting it up to build ES6 code into ES5 via B">
<meta property="og:updated_time" content="2016-09-03T13:23:59.656Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Starting a NodeJS Project - ES6">
<meta name="twitter:description" content="In the previous post, I set up a new NPM project to work with, and added in Grunt as a task runner so that we can do complex tasks if we want to. Next is setting it up to build ES6 code into ES5 via B">
<meta name="twitter:creator" content="@https://twitter.com/grahamcox82">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href='//fonts.useso.com/css?family=Open+Sans:400italic,400,600' rel='stylesheet' type='text/css'>
  <link href="//fonts.useso.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/blog/css/style.css">
  <link rel="stylesheet" href="/blog/font-awesome/css/font-awesome.min.css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-62627767-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>
<body>
  <div id="container">
    <header id="header">
  <div id="header-main" class="header-inner">
    <div class="outer">
      <a href="/blog/" id="logo"><i class="logo"></i><span class="site-title">The Wrong Language</span></a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/blog/">Home</a>
        
          <a class="main-nav-link" href="/blog/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        <div class="profile" id="profile-nav">
          <a id="profile-anchor" href="javascript:;"><img class="avatar" src="/blog/avatar.png"><i class="fa fa-caret-down"></i></a>
        </div>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"> </button><input type="hidden" name="sitesearch" value="https://sazzer.github.io/blog"></form>
      </div>
    </div>
  </div>
  <div id="main-nav-mobile" class="header-sub header-inner">
    <table class="menu outer">
      <tr>
      
        <td><a class="main-nav-link" href="/blog/">Home</a></td>
      
        <td><a class="main-nav-link" href="/blog/archives">Archives</a></td>
      
      <td>
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="hidden" name="sitesearch" value="https://sazzer.github.io/blog"></form>
      </td>
      </tr>
    </table>
  </div>
  
</header>

    <div class="outer">
      <aside id="profile">
  <div class="inner profile-inner">
  	<div class="base-info profile-block">
		  <img id="avatar" src="/blog/avatar.png">
      <h2 id="name">Graham Cox</h2>
      <h3 id="title">Software Developer</h3>
      <span id="location"><i class="fa fa-map-marker"></i>Sheffield, England</span>
      <a id="follow" href="https://twitter.com/grahamcox82">FOLLOW</a>
  	</div>
    <div class="article-info profile-block">
      <div class="article-info-block">
        18
        <span>posts</span>
      </div>
      <div class="article-info-block">
        28
        <span>tags</span>
      </div>
    </div>
    
    <div class="contact-info profile-block">
      <table class="contact-list">
        <tr>
        
          <td><a href="http://github.com/sazzer" target="_blank" title="github"><i class="fa fa-github"></i></a></td>
        
          <td><a href="https://twitter.com/grahamcox82" target="_blank" title="twitter"><i class="fa fa-twitter"></i></a></td>
        
          <td><a href="/blog/atom.xml" target="_blank" title="rss"><i class="fa fa-rss"></i></a></td>
        
        </tr>
      </table>
    </div>
    
  </div>
</aside>
      <section id="main"><article id="post-Starting-a-NodeJS-Project-ES6" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Starting a NodeJS Project - ES6
    </h1>
  

        <div class="article-meta">
          <div class="article-date">
  <i class="fa fa-calendar"></i>
  <a href="/blog/2015/08/19/Starting-a-NodeJS-Project-ES6/">
    <time datetime="2015-08-19T05:35:43.000Z" itemprop="datePublished">2015-08-19</time>
  </a>
</div>
          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/blog/categories/buildsystems/">buildsystems</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>In the previous post, I set up a new NPM project to work with, and added in Grunt as a task runner so that we can do complex tasks if we want to. Next is setting it up to build ES6 code into ES5 via Babel, so that we get to use the newer features - Classes, Arrow Functions, Destructuring, Let/Const, and so on - whilst running on a runtime that doesn’t yet support them - because no runtime yet supports ES6 fully.</p>
<p><a href="https://babeljs.io/" target="_blank" rel="external">Babel</a> is a Transpiler that we can use to automatically convert ES6 code into ES5 code for exactly this purpose. It literally takes existing ES6 source code as input, and converts it into ES5 source code as output - in the same way that a compiler would covert source code into machine code.</p>
<p>If we so desired, we could use the exact same setup for working with <a href="http://coffeescript.org/" target="_blank" rel="external">CoffeeScript</a>, <a href="https://www.dartlang.org/" target="_blank" rel="external">Dart</a>, <a href="http://www.typescriptlang.org/" target="_blank" rel="external">TypeScript</a>, or any of a <a href="https://github.com/jashkenas/coffeescript/wiki/List-of-languages-that-compile-to-JS" target="_blank" rel="external">growing set of languages</a> that we can convert into Javascript.</p>
<a id="more"></a>
<p>I always set up my projects with a consistent filesystem structure, so that I know what I’m talking about. This is largely stolen from Maven, simply because I know it and it works for me. As such, I work with the following structure:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">| package.json</div><div class="line">| GruntFile.js</div><div class="line">+ src</div><div class="line">  + node // This is where all of the Server-side code goes</div><div class="line">    | main</div><div class="line">    | test</div><div class="line">  + js // This is where all of the Client-side code goes</div><div class="line">    | main</div><div class="line">    | test</div><div class="line">+ target</div><div class="line">  + node // This is where all of the Server-side output goes</div><div class="line">    | main</div><div class="line">    | test</div></pre></td></tr></table></figure></p>
<p>Notably in comparison to Maven, I have the language and scope folders swapped around. This simply keeps things closer together.</p>
<p>Now, hwo to actually make this work? Everything is done in Grunt, which makes life easier. I’m only going to concentrate on the src/node stack for now - the src/js stack is different because it builds a single output file using Webpack instead of building lots of files using Babel. I’ll cover how that works in a later post.</p>
<p>Firstly, because we have some explicit areas that we work in, I always set up some variables at the top of my Gruntfile to handle this:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> srcDir = <span class="string">"src"</span>;</div><div class="line"><span class="keyword">var</span> srcNodeDir = path.join(srcDir, <span class="string">"node"</span>);</div><div class="line"><span class="keyword">var</span> srcNodeMainDir = path.join(srcNodeDir, <span class="string">"main"</span>);</div><div class="line"><span class="keyword">var</span> srcNodeTestDir = path.join(srcNodeDir, <span class="string">"test"</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> targetDir = <span class="string">"target"</span>;</div><div class="line"><span class="keyword">var</span> targetNodeDir = path.join(targetDir, <span class="string">"node"</span>);</div><div class="line"><span class="keyword">var</span> targetNodeMainDir = path.join(targetNodeDir, <span class="string">"main"</span>);</div><div class="line"><span class="keyword">var</span> targetNodeTestDir = path.join(targetNodeDir, <span class="string">"test"</span>);</div></pre></td></tr></table></figure></p>
<p>Next, because we’re creating a target area to work, it’s only polite to tidy it up as well. This is done with the grunt-contrib-clean module, configured as such:<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">clean: &#123;</div><div class="line">    build: &#123;</div><div class="line">        src: targetDir</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Literally, this means that if you run “grunt clean” then it will delete the “target” directory. That’s it.</p>
<p>Next comes actual compilation of the source code from ES6 to ES5. This is done using Babel, and specifically with the grunt-babel module. Note that there are certain ES6 constructs that you may want to use that will also require the babel-runtime module being installed, and this as an actual dependency as opposed to a development dependency.</p>
<p>The configuration of Babel is a bit more involved, but not by much:<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">babel: &#123;</div><div class="line">    options: &#123;</div><div class="line">        sourceMap: true,</div><div class="line">        optional: "runtime"</div><div class="line">    &#125;,</div><div class="line">    nodeMain: &#123;</div><div class="line">        files: [&#123;</div><div class="line">            expand: true,</div><div class="line">            cwd: srcNodeMainDir,</div><div class="line">            src: ["**/*.js"],</div><div class="line">            dest: targetNodeMainDir</div><div class="line">        &#125;]</div><div class="line">    &#125;,</div><div class="line">    test: &#123;</div><div class="line">        files: [&#123;</div><div class="line">            expand: true,</div><div class="line">            cwd: srcNodeTestDir,</div><div class="line">            src: ["**/*.js"],</div><div class="line">            dest: targetNodeTestDir</div><div class="line">        &#125;]</div><div class="line">    &#125;</div><div class="line">&#125;,</div></pre></td></tr></table></figure></p>
<p>Having done that, you can now run “grunt babel”, and you should see all of your ES6 files that you’ve written in src/node/main turn up as ES5 code in target/node/main, and likewise for src/node/test into target/node/test.</p>
<p>Unfortunately, it doesn’t quite work. Almost everything is fine, but module loading is a bit tricky. This is because of the module loader needing to know where to find the modules. The way that I get around this is a bit of a hack, but works, and that is to set the <em>NODE_PATH</em> environment variable. The way that I do this has the disadvantage that I can only easily run the code from Grunt, but that’s a small price to pay I find.</p>
<p>I do this by using the grunt-env and grunt-execute modules, and configuring as follows:<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">env: &#123;</div><div class="line">    node: &#123;</div><div class="line">        NODE_PATH: targetNodeMainDir</div><div class="line">    &#125;</div><div class="line">&#125;,</div><div class="line">execute: &#123;</div><div class="line">    node: &#123;</div><div class="line">        src: path.join(targetNodeMainDir, "main.js")</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>I now need to change the task registrations to execute all of the plugins in the correct order. This now looks like:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">grunt.registerTask(<span class="string">"build"</span>, [<span class="string">"babel:node"</span>]);</div><div class="line">grunt.registerTask(<span class="string">"run"</span>, [<span class="string">"build"</span>, <span class="string">"env:node"</span>, <span class="string">"execute:node"</span>]);</div></pre></td></tr></table></figure></p>
<p>As of this point, executing “npm install” will correctly build all of your ES6 code into ES5 code, and executing “npm start” will do this and then execute the code you wrote in “src/node/main/main.js”. </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://sazzer.github.io/blog/blog/2015/08/19/Starting-a-NodeJS-Project-ES6/" data-id="cisn813wj000t6lg58eb7plzg" class="article-share-link">Share</a>
      
        <a href="https://sazzer.github.io/blog/blog/2015/08/19/Starting-a-NodeJS-Project-ES6/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/es6/">es6</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/grunt/">grunt</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/javascript/">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/nodejs/">nodejs</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/blog/2015/08/19/Starting-a-NodeJS-Project-Testing/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Starting a NodeJS Project - Testing
        
      </div>
    </a>
  
  
    <a href="/blog/2015/08/18/Starting-a-NodeJS-Project/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Starting a NodeJS Project - Project Setup</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>
</section>
      
        <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">recents</h3>
    <div class="widget">
      <ul id="recent-post" class="no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/blog/categories/programming/">programming</a></p>
              <p class="item-title"><a href="/blog/2016/09/03/OpenID-Connect-Response-Types/" class="title">OpenID Connect Response Types</a></p>
              <p class="item-date"><time datetime="2016-09-03T12:40:28.000Z" itemprop="datePublished">2016-09-03</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/blog/categories/programming/">programming</a></p>
              <p class="item-title"><a href="/blog/2016/05/29/TDD-with-Static-Typed-Languages/" class="title">TDD with Static Typed Languages</a></p>
              <p class="item-date"><time datetime="2016-05-29T14:12:50.000Z" itemprop="datePublished">2016-05-29</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/blog/categories/programming/">programming</a></p>
              <p class="item-title"><a href="/blog/2016/05/08/I-disagree-with-HATEOAS/" class="title">I disagree with HATEOAS</a></p>
              <p class="item-date"><time datetime="2016-05-08T10:22:01.000Z" itemprop="datePublished">2016-05-08</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/blog/categories/programming/">programming</a></p>
              <p class="item-title"><a href="/blog/2016/05/07/Designing-a-GraphQL-API/" class="title">Designing a GraphQL API</a></p>
              <p class="item-date"><time datetime="2016-05-07T09:09:59.000Z" itemprop="datePublished">2016-05-07</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/blog/categories/programming/">programming</a></p>
              <p class="item-title"><a href="/blog/2016/05/06/I-don-t-like-Relay/" class="title">I don&#39;t like Relay</a></p>
              <p class="item-date"><time datetime="2016-05-06T17:48:49.000Z" itemprop="datePublished">2016-05-06</time></p>
            </div>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/blog/categories/blog/">blog</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/buildsystems/">buildsystems</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/programming/">programming</a><span class="category-list-count">12</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">tag cloud</h3>
    <div class="widget tagcloud">
      <a href="/blog/tags/HATEOAS/" style="font-size: 10px;">HATEOAS</a> <a href="/blog/tags/REST/" style="font-size: 10px;">REST</a> <a href="/blog/tags/TDD/" style="font-size: 10px;">TDD</a> <a href="/blog/tags/ajax/" style="font-size: 10px;">ajax</a> <a href="/blog/tags/api/" style="font-size: 20px;">api</a> <a href="/blog/tags/cors/" style="font-size: 10px;">cors</a> <a href="/blog/tags/es5/" style="font-size: 10px;">es5</a> <a href="/blog/tags/es6/" style="font-size: 15px;">es6</a> <a href="/blog/tags/github/" style="font-size: 10px;">github</a> <a href="/blog/tags/graphql/" style="font-size: 17.5px;">graphql</a> <a href="/blog/tags/grunt/" style="font-size: 15px;">grunt</a> <a href="/blog/tags/hexo/" style="font-size: 12.5px;">hexo</a> <a href="/blog/tags/javascript/" style="font-size: 20px;">javascript</a> <a href="/blog/tags/mocha/" style="font-size: 10px;">mocha</a> <a href="/blog/tags/mockery/" style="font-size: 10px;">mockery</a> <a href="/blog/tags/mocks/" style="font-size: 10px;">mocks</a> <a href="/blog/tags/mongodb/" style="font-size: 10px;">mongodb</a> <a href="/blog/tags/nodejs/" style="font-size: 20px;">nodejs</a> <a href="/blog/tags/oauth2/" style="font-size: 10px;">oauth2</a> <a href="/blog/tags/oidc/" style="font-size: 10px;">oidc</a> <a href="/blog/tags/openid/" style="font-size: 10px;">openid</a> <a href="/blog/tags/openid-connect/" style="font-size: 10px;">openid connect</a> <a href="/blog/tags/rant/" style="font-size: 10px;">rant</a> <a href="/blog/tags/relay/" style="font-size: 15px;">relay</a> <a href="/blog/tags/s3/" style="font-size: 10px;">s3</a> <a href="/blog/tags/testing/" style="font-size: 15px;">testing</a> <a href="/blog/tags/travisci/" style="font-size: 12.5px;">travisci</a> <a href="/blog/tags/webdev/" style="font-size: 10px;">webdev</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2016/09/">September 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2016/05/">May 2016</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2016/01/">January 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2015/10/">October 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2015/08/">August 2015</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2015/07/">July 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2015/06/">June 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2015/05/">May 2015</a><span class="archive-list-count">4</span></li></ul>
    </div>
  </div>

  
  <div id="toTop" class="fa fa-chevron-up"></div>
</aside>
      
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 Graham Cox<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>
    </div>
  </div>
</footer>
    

<script>
  var disqus_shortname = 'thewronglanguage';
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//code.jquery.com/jquery-2.0.3.min.js"></script>


  <link rel="stylesheet" href="/blog/fancybox/jquery.fancybox.css">
  <script src="/blog/fancybox/jquery.fancybox.pack.js"></script>


<script src="/blog/js/script.js"></script>

  </div>
</body>
</html>